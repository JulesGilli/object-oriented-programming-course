# 3. Constructeurs

## Objectif

Comprendre le rôle et la syntaxe des **constructeurs** en C#, leur utilisation pour initialiser les objets, et les différentes formes qu’ils peuvent prendre (par défaut, paramétrés, surchargés).

---

## Définition et explication

Un **constructeur** est une **méthode spéciale** d’une classe, utilisée pour **initialiser un objet** au moment de sa création.
Il porte **le même nom que la classe** et **n’a pas de type de retour** (pas même `void`).

Lorsqu’on crée un objet avec le mot-clé `new`, le constructeur est **automatiquement appelé** pour définir l’état initial de cet objet.

Exemple général :

```csharp
var joueur = new Joueur("Arthur", 100);
```

Ici, l’instruction `new Joueur(...)` appelle un constructeur de la classe `Joueur`, qui initialise l’objet avec les valeurs fournies.

Les constructeurs sont essentiels pour garantir que chaque objet commence dans un **état cohérent et valide**, en évitant les erreurs liées à des champs non initialisés.

---

## Constructeur par défaut

Si aucune définition explicite de constructeur n’est fournie, le compilateur C# crée automatiquement un **constructeur par défaut sans paramètre**.
Ce constructeur initialise simplement les attributs avec leurs valeurs par défaut (par exemple `0`, `false`, ou `null`).

Exemple :

```csharp
public class Arme
{
    public string Nom;
    public int Degats;
}
```

On peut alors écrire :

```csharp
var epee = new Arme();  // constructeur implicite par défaut
```

Dans ce cas, `Nom` sera `null` et `Degats` sera `0` jusqu’à ce qu’on leur assigne des valeurs.

---

## Constructeur explicite

Il est possible de définir soi-même un constructeur pour contrôler la manière dont les objets sont créés.

```csharp
public class Arme
{
    public string Nom;
    public int Degats;

    public Arme(string nom, int degats)
    {
        Nom = nom;
        Degats = degats;
    }
}
```

Ici, le constructeur exige que `Nom` et `Degats` soient fournis dès la création de l’objet :

```csharp
var arc = new Arme("Arc long", 25);
```

Ainsi, chaque objet `Arme` créé via ce constructeur aura des valeurs cohérentes dès le départ.

---

## Surcharge de constructeurs

Une classe peut définir **plusieurs constructeurs** avec des signatures différentes (nombres ou types de paramètres distincts).
Ce mécanisme est appelé **surcharge** (*constructor overloading*).

```csharp
public class Joueur
{
    public string Nom;
    public int PointsDeVie;

    // Constructeur par défaut
    public Joueur()
    {
        Nom = "Inconnu";
        PointsDeVie = 100;
    }

    // Constructeur avec paramètres
    public Joueur(string nom, int pv)
    {
        Nom = nom;
        PointsDeVie = pv;
    }
}
```

On peut alors créer un joueur de deux façons :

```csharp
var j1 = new Joueur();              // Nom = "Inconnu", PointsDeVie = 100
var j2 = new Joueur("Arthur", 150); // Nom = "Arthur", PointsDeVie = 150
```

Cela permet d’offrir **plusieurs options d’initialisation** selon le contexte d’utilisation.

---

## Initialisation par propriétés

En C#, on peut aussi initialiser les champs ou propriétés d’un objet directement lors de sa création, sans définir de constructeur, grâce à la **syntaxe d’initialisation d’objets**.

```csharp
var joueur = new Joueur
{
    Nom = "Lancelot",
    PointsDeVie = 120
};
```

Cette approche est utile pour des objets simples ou des scénarios de configuration, mais **n’offre pas de contrôle logique** (comme des vérifications ou calculs) qu’un constructeur pourrait effectuer.

---

## Appel de constructeurs en chaîne

Un constructeur peut appeler un autre constructeur de la même classe à l’aide du mot-clé `this`, afin d’éviter la duplication de code.

```csharp
public class Arme
{
    public string Nom;
    public int Degats;

    public Arme() : this("Épée standard", 10) { }

    public Arme(string nom, int degats)
    {
        Nom = nom;
        Degats = degats;
    }
}
```

Ici, le constructeur sans paramètre réutilise la logique du constructeur complet, assurant une initialisation uniforme.

---

## Constructeur statique

Un **constructeur statique** est un constructeur spécial utilisé pour initialiser les **membres statiques** d’une classe.
Il est appelé **automatiquement une seule fois** avant la première utilisation de la classe.

```csharp
public class Configuration
{
    public static string Version;

    static Configuration()
    {
        Version = "1.0.0";
        Console.WriteLine("Configuration initialisée.");
    }
}
```

Ce type de constructeur n’a ni modificateur d’accès ni paramètres.

---

## Exemple complet minimal

```csharp
public class Voiture
{
    public string Marque;
    public int VitesseMax;

    public Voiture(string marque, int vitesse)
    {
        Marque = marque;
        VitesseMax = vitesse;
    }

    public void AfficherInfo()
    {
        Console.WriteLine($"{Marque} atteint {VitesseMax} km/h.");
    }
}

var v = new Voiture("Tesla", 250);
v.AfficherInfo();
```

**Sortie :**

```
Tesla atteint 250 km/h.
```

---

## Lien avec Unity

Dans Unity, les constructeurs personnalisés ne sont **pas utilisés directement** pour les scripts dérivés de `MonoBehaviour`.
Les objets Unity sont créés via le moteur lui-même (par instanciation de `GameObject` ou duplication de *prefabs*).

Toutefois, l’idée d’initialisation existe sous d’autres formes :

* `Awake()` et `Start()` remplissent un rôle similaire à un constructeur : ils préparent les données avant l’utilisation de l’objet.
* Pour les classes C# non attachées à des GameObjects (comme des systèmes de gestion, des modèles de données ou des *ScriptableObjects*), les constructeurs sont pleinement applicables.

Ainsi, le concept reste fondamental même si son usage diffère selon le type d’objet dans Unity.

---

## Références utiles

* [Microsoft Learn — Constructeurs (C#)](https://learn.microsoft.com/fr-fr/dotnet/csharp/programming-guide/classes-and-structs/constructors)
* [Microsoft Learn — Constructeurs statiques](https://learn.microsoft.com/fr-fr/dotnet/csharp/programming-guide/classes-and-structs/static-constructors)
* [Unity Manual — Order of Execution for Event Functions](https://docs.unity3d.com/Manual/ExecutionOrder.html)
* Skeet, Jon. *C# in Depth*, Manning Publications, 2019.
